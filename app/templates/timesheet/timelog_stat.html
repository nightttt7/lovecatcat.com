{% extends "base.html" %}
{% block content %}
<div class="container-lg mb-3 pb-6">
  <div class="mt-6 ml-6 mr-6 mb-6">
    <p class="h2"><a href="{{ url_for('timesheet.index') }}" class="text-blue">Return timesheet</a></p>
    <p><a class="h1 text-green" href="{{ url_for('timesheet.timelog_finished') }}">Time Logs</a> <a class="h3 text-orange" href="{{ url_for('timesheet.timelog_stat') }}">Statistics</a></p>
    {% if result_mode %}
    <table>
      <tr>
        <td class="f3 text-bold pr-3">Project</td>
        <td class="f3 text-bold pr-3">Task</td>
        <td class="f3 text-bold pr-3">Period</td>
        <td class="f3 text-bold pr-3">Duration</td>
      </tr>
      {% for timelog in result %}
      <tr>
        <td class="f3 pr-3">
          <a class="link-gray-dark" href="{{ url_for('timesheet.timelog_finished', project=timelog.project) }}">{{ timelog.project }}</a>
        </td>
        <td class="f3 pr-3">
          <a class="link-gray-dark" href="{{ url_for('timesheet.timelog_finished', project=timelog.project, task=timelog.task) }}">{{ timelog.task }}</a>
        </td>
        <td class="f4 pr-3">
          <a class="link-gray-dark" href="{{ url_for('timesheet.timelog_finished', date=timelog.timestamp_start.strftime('%Y-%m-%d')) }}">{{ moment(timelog.timestamp_start).format('Y-MM-DD') }}</a> {{ moment(timelog.timestamp_start).format('HH:mm') }}~{{ moment(timelog.timestamp_end).format('HH:mm') }}
        </td>
        <td class="f4 pr-3">
          {{ timelog.time_delta_seconds//3600 }}h {{ timelog.time_delta_seconds//60%60 }}m
        </td>
      </tr>
      {% endfor %}
    </table>
    {% endif %}
    <form class="mt-3" method="post">
      <fieldset>
        <legend hidden>Add timelog</legend>
        {{ form_stat_timelog.hidden_tag() }}
        <div>
          <div>
            {{ form_stat_timelog.project_stat.label() }} (use ctrl/cmd to select multiple projects, select all to select all)
          </div>
          <div class="mb-3 mr-6">
            {{ form_stat_timelog.project_stat(class="form-select input-lg", size=num_project, ) }}
          </div>
        </div>
        <div>
          <div>
            {{ form_stat_timelog.stat_start.label() }}
          </div>
          <div class="mb-3 mr-6">
            {{ form_stat_timelog.stat_start(class="form-control", size="18") }}
          </div>
        </div>
        <div>
          <div>
            {{ form_stat_timelog.stat_end.label() }}
          </div>
          <div class="mb-3 mr-6">
            {{ form_stat_timelog.stat_end(class="form-control", size="18") }}
          </div>
        </div>
        {{ form_stat_timelog.utc_offset(type="hidden") }}
        {{ form_stat_timelog.submit_stat(class="btn") }}
      </fieldset>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
function setDefaultTime () {
  document.getElementById("stat_start").value = moment().format("Y-MM-DD");
  document.getElementById("stat_end").value = moment().format("Y-MM-DD");
}

function setUtcOffset () {
  document.getElementById("utc_offset").value = moment().utcOffset();
}

setDefaultTime ()
setUtcOffset ()
</script>
{% endblock %}